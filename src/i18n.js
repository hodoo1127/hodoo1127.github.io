export const I18N = {
  ko:{title:"Everyday Tools", theme_light:"라이트 테마", theme_dark:"다크 테마",
    tab_stopwatch:"스톱워치", tab_countdown:"타이머", tab_pw:"비밀번호 생성", tab_text:"문자/대소문자", tab_url:"URL 인/디코더", tab_memo:"메모장", tab_privacy:"개인정보/쿠키",
    ad_top:"광고 영역(728x90 반응형)", ad_footer:"푸터 광고 영역",
    stopwatch:"스톱워치", start:"시작", stop:"정지", lap:"랩", reset:"리셋",
    countdown:"카운트다운 타이머", minutes_ph:"분", seconds_ph:"초", beep_on_end:"종료 시 비프음", bg_precision:"백그라운드 탭에서는 정밀도가 낮아질 수 있습니다. 비프음이 들리지 않으면 브라우저 자동재생/사운드 설정을 확인해 주세요.",
    pwgen:"비밀번호 생성기", length:"길이", uppercase:"대문자", lowercase:"소문자", numbers:"숫자", symbols:"기호", no_ambig:"유사문자 제외", pw_placeholder:"여기에 생성됩니다", copy:"복사", generate:"생성", crypto_note:"브라우저 보안 난수 생성기 사용.",
    text_tools:"문자수 세기 / 대소문자 변환", text_ph:"여기에 텍스트를 입력하세요", upper:"UPPER", lower:"lower", title_case:"Title Case", clear:"지우기",
    url_tools:"URL 인코더 / 디코더", text_or_url:"텍스트 또는 URL", encode:"encodeURIComponent", decode:"decodeURIComponent", result:"결과",
    memo:"메모장", file_name_optional:"파일 이름(옵션) — 비워두면 자동 생성", memo_ph:"여기에 메모를 작성하세요. 내용은 자동 저장됩니다(LocalStorage).", save_txt:"txt 파일로 저장", autosaved:"자동 저장됨",
    choose_file:"파일 선택", no_file:"선택된 파일 없음",
    about_title:"사이트 소개", about_desc:"일상 유틸리티 모음. 광고 슬롯이 준비되어 있어 AdSense 승인 즉시 수익화 가능합니다.", brand:"Everyday Tools",
    stats_fmt:"전체문자(공백포함) {total} · 문자 {chars} · 공백 {spaces} · 단어 {words} · 줄 {lines}",
    minus10m:"−10분", minus1m:"−1분", plus1m:"+1분", plus10m:"+10분",
    minus10s:"−10초", minus1s:"−1초", plus1s:"+1초", plus10s:"+10초",
    privacy_h1:"개인정보 처리방침 · 쿠키 고지", privacy_back:"← 돌아가기",
    privacy_collect_title:"수집 항목",
    privacy_collect_body:"본 사이트는 계정을 요구하지 않으며, 사용자 입력은 브라우저 로컬 저장소(LocalStorage)에 저장됩니다.",
    privacy_ads_title:"광고(AdSense)",
    privacy_ads_body:"Google AdSense는 쿠키 및 광고 ID를 활용하여 개인 맞춤 광고를 제공할 수 있습니다. 자세한 내용은 다음 문서를 참조하십시오:",
    privacy_ads_link_text:"Google 광고 기술 정책",
    privacy_contact_title:"문의",
    privacy_contact_prefix:"운영자 이메일:"
  },
  en:{title:"Everyday Tools", theme_light:"Light theme", theme_dark:"Dark theme",
    tab_stopwatch:"Stopwatch", tab_countdown:"Timer", tab_pw:"Password Generator", tab_text:"Text/Case", tab_url:"URL Encode/Decode", tab_memo:"Memo", tab_privacy:"Privacy/Cookies",
    ad_top:"Ad slot (728x90, responsive)", ad_footer:"Footer Ad slot",
    stopwatch:"Stopwatch", start:"Start", stop:"Stop", lap:"Lap", reset:"Reset",
    countdown:"Countdown Timer", minutes_ph:"minutes", seconds_ph:"seconds", beep_on_end:"Beep on end", bg_precision:"Timing may be less precise in background tabs. If you don't hear the beep, check your browser's autoplay/sound setting.",
    pwgen:"Password Generator", length:"Length", uppercase:"Uppercase", lowercase:"Lowercase", numbers:"Numbers", symbols:"Symbols", no_ambig:"Exclude ambiguous", pw_placeholder:"Generated text appears here", copy:"Copy", generate:"Generate", crypto_note:"Uses browser cryptographic RNG.",
    text_tools:"Character Counter / Case Converter", text_ph:"Type text here", upper:"UPPER", lower:"lower", title_case:"Title Case", clear:"Clear",
    url_tools:"URL Encoder / Decoder", text_or_url:"Text or URL", encode:"encodeURIComponent", decode:"decodeURIComponent", result:"Result",
    memo:"Memo Pad", file_name_optional:"File name (optional) — auto if blank", memo_ph:"Write notes here. Autosaves to LocalStorage.", save_txt:"Save as .txt", autosaved:"Autosaved",
    choose_file:"Choose file", no_file:"No file selected",
    about_title:"About this site", about_desc:"A bundle of everyday utilities. Ready for AdSense monetization.", brand:"Everyday Tools",
    stats_fmt:"Total (incl. spaces) {total} · Chars {chars} · Spaces {spaces} · Words {words} · Lines {lines}",
    minus10m:"−10 min", minus1m:"−1 min", plus1m:"+1 min", plus10m:"+10 min",
    minus10s:"−10 sec", minus1s:"−1 sec", plus1s:"+1 sec", plus10s:"+10 sec",
    privacy_h1:"Privacy Policy · Cookies Notice", privacy_back:"← Back",
    privacy_collect_title:"Data We Collect",
    privacy_collect_body:"This site requires no account. User input stays in your browser’s LocalStorage.",
    privacy_ads_title:"Advertising (AdSense)",
    privacy_ads_body:"Google AdSense may use cookies and advertising IDs to serve personalized ads. See:",
    privacy_ads_link_text:"Google Ads & cookies policy",
    privacy_contact_title:"Contact",
    privacy_contact_prefix:"Operator email:"
  },
  es:{title:"Herramientas Diarias", theme_light:"Tema claro", theme_dark:"Tema oscuro",
    tab_stopwatch:"Cronómetro", tab_countdown:"Temporizador", tab_pw:"Generador de contraseñas", tab_text:"Texto/Mayús-Minús", tab_url:"Cod/Decod URL", tab_memo:"Bloc de notas", tab_privacy:"Privacidad/Cookies",
    ad_top:"Espacio publicitario (728x90, adaptable)", ad_footer:"Espacio publicitario en el pie",
    stopwatch:"Cronómetro", start:"Iniciar", stop:"Detener", lap:"Vuelta", reset:"Reiniciar",
    countdown:"Temporizador de cuenta atrás", minutes_ph:"minutos", seconds_ph:"segundos", beep_on_end:"Pitido al finalizar", bg_precision:"Puede perder precisión en segundo plano. Si no escucha el pitido, revise la configuración de sonido/autoplay del navegador.",
    pwgen:"Generador de contraseñas", length:"Longitud", uppercase:"Mayúsculas", lowercase:"Minúsculas", numbers:"Números", symbols:"Símbolos", no_ambig:"Excluir ambiguos", pw_placeholder:"Aquí se mostrará el resultado", copy:"Copiar", generate:"Generar", crypto_note:"Usa RNG criptográfico del navegador.",
    text_tools:"Contador de caracteres / Conversor de mayúsculas", text_ph:"Escribe aquí", upper:"MAYÚS", lower:"minús", title_case:"Título", clear:"Limpiar",
    url_tools:"Codificador / Decodificador de URL", text_or_url:"Texto o URL", encode:"encodeURIComponent", decode:"decodeURIComponent", result:"Resultado",
    memo:"Bloc de notas", file_name_optional:"Nombre de archivo (opcional) — auto si está vacío", memo_ph:"Escribe notas aquí. Guardado automático en LocalStorage.", save_txt:"Guardar como .txt", autosaved:"Guardado automático",
    choose_file:"Elegir archivo", no_file:"Ningún archivo seleccionado",
    about_title:"Acerca del sitio", about_desc:"Conjunto de utilidades diarias. Listo para monetización con AdSense.", brand:"Herramientas Diarias",
    stats_fmt:"Total (incl. spaces) {total} · Caracteres {chars} · Espacios {spaces} · Palabras {words} · Líneas {lines}",
    minus10m:"−10 min", minus1m:"−1 min", plus1m:"+1 min", plus10m:"+10 min",
    minus10s:"−10 s", minus1s:"−1 s", plus1s:"+1 s", plus10s:"+10 s",
    privacy_h1:"Política de privacidad · Aviso de cookies", privacy_back:"← Volver",
    privacy_collect_title:"Datos que recopilamos",
    privacy_collect_body:"Este sitio no requiere cuenta. Lo que escribe se guarda en el LocalStorage de su navegador.",
    privacy_ads_title:"Publicidad (AdSense)",
    privacy_ads_body:"Google AdSense puede usar cookies e identificadores publicitarios para mostrar anuncios personalizados. Consulte:",
    privacy_ads_link_text:"Política de anuncios y cookies de Google",
    privacy_contact_title:"Contacto",
    privacy_contact_prefix:"Correo del responsable:"
  }
};

const SUPPORTED = ["ko","en","es"];
function pickLang(x){ return SUPPORTED.includes(x) ? x : "en"; }
function detectLang(){
  const ls = localStorage.getItem("langForce");
  if (ls && SUPPORTED.includes(ls)) return ls;
  const nav = (navigator.languages && navigator.languages[0]) || navigator.language || "en";
  return pickLang(nav.slice(0,2).toLowerCase());
}

let currentLang = detectLang();
const subscribers = new Set();

export function getLang(){ return currentLang; }
export function setLang(newLang){
  currentLang = pickLang(String(newLang||"").toLowerCase());
  localStorage.setItem("langForce", currentLang);
  applyI18n();
  window.dispatchEvent(new CustomEvent("langchange"));
}
export function subscribeI18n(fn){ subscribers.add(fn); return ()=>subscribers.delete(fn); }
export function getDict(){ return I18N[currentLang] || I18N.en; }

export function applyI18n(root=document){
  const d = getDict();
  document.documentElement.setAttribute("lang", currentLang);
  root.querySelectorAll("[data-i18n]").forEach(n=>{
    const k=n.getAttribute("data-i18n"); if(d[k]) n.textContent=d[k];
  });
  root.querySelectorAll("[data-i18n-ph]").forEach(n=>{
    const k=n.getAttribute("data-i18n-ph"); if(d[k]) n.setAttribute("placeholder", d[k]);
  });
  subscribers.forEach(fn=>{ try{ fn(d); }catch{} });
}
